<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì ìœ ìœ¨ ë¶„ì„</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; background-color: #f5f6f7; display: flex; justify-content: center; padding: 40px 20px; margin: 0; }
        .container { width: 100%; max-width: 600px; background: white; border-radius: 10px; padding-bottom: 20px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .header { background: #00d344; color: white; padding: 20px; text-align: center; margin-bottom: 20px; }
        .chart-box { width: 80%; margin: 0 auto 30px auto; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px 20px; border-bottom: 1px solid #eee; text-align: left; }
        th { background: #f9f9f9; color: #555; font-size: 14px; }
        .badge { background: #00d344; color: white; padding: 4px 8px; border-radius: 10px; font-size: 12px; }
        .back-btn { display: block; width: 200px; margin: 30px auto 0; padding: 12px; background: #333; color: white; text-align: center; text-decoration: none; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header"><h1>ğŸ“Š ê°€ìˆ˜ë³„ ì ìœ ìœ¨ (TOP 10)</h1></div>
        
        <div class="chart-box"><canvas id="shareChart"></canvas></div>

        <h3 style="text-align:center; color:#333;">ìƒì„¸ ìˆœìœ„</h3>
        <table>
            <thead><tr><th>ìˆœìœ„</th><th>ê°€ìˆ˜</th><th style="text-align:right;">ê³¡ ìˆ˜</th></tr></thead>
            <tbody>
                {% for row in all_data %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td style="font-weight:bold;">{{ row.artist }}</td>
                    <td style="text-align:right;"><span class="badge">{{ row.count }}ê³¡</span></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <a href="/melon" class="back-btn">ëª©ë¡ìœ¼ë¡œ</a>
    </div>

    <!-- [ìˆ˜ì • ì™„ë£Œ] ensure_ascii ì˜µì…˜ì„ ì œê±°í•˜ì—¬ êµ¬ë²„ì „ Flaskì—ì„œë„ ì˜¤ë¥˜ê°€ ë‚˜ì§€ ì•Šë„ë¡ í–ˆìŠµë‹ˆë‹¤. -->
    <script id="json-labels" type="application/json">{{ labels | tojson }}</script>
    <script id="json-values" type="application/json">{{ values | tojson }}</script>

    <script>
        // ìˆ¨ê²¨ì§„ íƒœê·¸ì—ì„œ ë°ì´í„° í…ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
        const labelsText = document.getElementById('json-labels').textContent;
        const valuesText = document.getElementById('json-values').textContent;

        // í…ìŠ¤íŠ¸ë¥¼ ìë°”ìŠ¤í¬ë¦½íŠ¸ ê°ì²´(ë°°ì—´)ë¡œ ë³€í™˜
        // ë°ì´í„°ê°€ ì—†ê±°ë‚˜ ì˜¤ë¥˜ê°€ ë‚  ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ ë¹ˆ ë°°ì—´ '[]'ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •
        const labels = labelsText ? JSON.parse(labelsText) : [];
        const values = valuesText ? JSON.parse(valuesText) : [];

        // ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        const ctx = document.getElementById('shareChart').getContext('2d');
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: labels,
                datasets: [{
                    data: values,
                    backgroundColor: ['#00d344','#36a2eb','#ffce56','#ff6384','#9966ff','#4bc0c0','#ff9f40','#c9cbcf','#7CFC00','#008080'],
                    borderWidth: 1
                }]
            },
            options: { 
                responsive: true, 
                plugins: { 
                    legend: { position: 'bottom' } 
                } 
            }
        });
    </script>
</body>
</html>